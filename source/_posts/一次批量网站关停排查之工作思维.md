---
title: 一次批量网站关停排查之工作思维
date: 2020-08-14 00:08:05
tags:
---
# 施工中。。。
先放脚本piliang.sh如下：
```bash
#!/bin/bash
for line in `cat iplist.txt | grep -v ^# |grep -v ^$`
do  
    ip=`echo $line | awk 'BEGIN{FS="|"} {print $1}'`
    port=`echo $line | awk 'BEGIN{FS="|"} {print $2}'`
    echo "(sleep 1;) | telnet $ip $port"
    (sleep 1;) | telnet $ip $port > telnet_result.txt
    result=`cat telnet_result.txt | grep -B 1 \] | grep [0-9] | awk '{print $3}' | cut -d '.' -f 1,2,3,4`
    echo "$result"
    if [ -n "$result" ]; then
        echo "$result | $port" >> telnet_alive.txt
    else
        echo "*********************************************************************************************** $ip $port not pass"
     fi
done
cat iplist.txt telnet_alive.txt |sort|uniq -u| grep -v ^# > telnet_died.txt
echo "telnet is over"
```
iplist.txt示例如下：
```
192.168.191.150|8001|
192.168.191.150|8002|
```